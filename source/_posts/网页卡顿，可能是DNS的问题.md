---
title: 网页卡顿，可能是DNS的问题？
top: false
cover: false
toc: true
mathjax: true
date: 2020-07-30 22:23:58
password:
summary:
tags: 网络
categories: 随笔 
---

# 网页卡顿，可能是DNS的问题？
## 问题

最近一段时间，一直忙于复习和刷题中，但某一天，突然发现leetcode中国和bilibili网页无比的卡顿。第一反应是中国电信又给宽带加了限制吗，再加上现在也不是晚上的高峰期呀，为什么？反复重启光猫和路由器，可问题并没有得到解决。

后来的某一天，也许是无独有偶，突然发现网络设置中dns默认是8.8.8.8，难道是它的问题吗？尝试性的换成114.114.114.144，发现困扰的卡顿问题居然解决了，今天决定把思考的前后过程整理一下。

## 思考

首先，我们知道，DNS是一个分层的DNS服务器实现的分布式数据库，它进行着主机名到IP地址转换的服务。

要想用户主机能够将一个HTTP请求发送到B站的web服务器，该用户必须知道其IP地址，而获取的过程大致如下:

> 1. 用户主机上运行着DNS客户端
> 2. 浏览器从URL中获取主机名www.bilibili.com，并将其传给主机上运行的DNS应用客户端
> 3. DNS客户端向DNS服务器发送一个包含主机名的请求
> 4. DNS客户会收到 一份回答报文，其中含有对应于该主机名的IP地址
> 5. 一旦浏览器收到DNS的响应IP地址，它就向该IP地址的80或者443端口的HTTP服务器进程发起一个TCP连接

但由于8.8.8.8是位于国外google的DNS服务器，获取DNS报文的时延肯定要比国内邻近的DNS服务器响应时延要长，且不考虑UDP来回过墙时的丢包问题和负载分配的造成的响应服务器IP的地域随机性。不要怀疑，以下情况是真实存在的，哎！

![image-bilibilidns](/images/image-bilibilidns.png)

## 感慨

这是一个简单的网络问题，但最近发生了很多事，还是难免产生些感慨；不在其位不谋其事，也只能这样安慰自己了！也许我们无法改变社会，可能自己也会被改变，但请保持初心，踟蹰前行！


